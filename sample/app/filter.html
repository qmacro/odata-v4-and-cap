<h1 id="all-things-filter-and-more">All things $filter and more</h1>
<!-- Auto build the HTML from this by running bin/autorebuildfilter -->
<h2 id="notes">Notes</h2>
<p>These examples use various OData services:</p>
<ul>
<li><a href="https://services.odata.org/v4/northwind/northwind.svc/">Northwind V4</a></li>
<li><a href="https://www.odata.org/blog/trippin-new-odata-v4-sample-service/">TripPin</a></li>
<li><a href="http://localhost:4004/northwind-model/">The CAP based V4 OData service in this repository</a></li>
</ul>
<p>To run the CAP based V4 OData service in this repository, use <code>cds run</code>. The default port 4004 is used.</p>
<h2 id="basic-usage">Basic usage</h2>
<h3 id="logical-operators">Logical operators</h3>
<p><strong>Products that are discontinued</strong> <br><a href="http://localhost:4004/northwind-model/Products?$filter=Discontinued%20eq%20true">Products?$filter=Discontinued eq true</a> <br>Basic, single filter on collection with logical operator <code>eq</code></p>
<p><strong>Products that are discontinued but there is still stock</strong> <br><a href="http://localhost:4004/northwind-model/Products?$filter=Discontinued%20eq%20true%20and%20UnitsInStock%20gt%200">Products?$filter=Discontinued eq true and UnitsInStock gt 0</a> <br>Combination of filters with logical operators <code>eq</code>, <code>gt</code> and <code>and</code></p>
<p><strong>Products in Category 2 that are expensive (25.00 or more)</strong> <br><a href="http://localhost:4004/northwind-model/Categories/2/Products?$filter=UnitPrice%20ge%2025.00">Categories/2/Products?$filter=UnitPrice ge 25.00</a> <br>Filter on collection via navigation with logical operator <code>ge</code></p>
<p><strong>All people with female gender</strong> <br><a href="https://services.odata.org/V4/TripPinService/People?$filter=Gender%20has%20Microsoft.OData.SampleService.Models.TripPin.PersonGender%27Female%27">People/$filter=Gender has Microsoft.OData.SampleService.Models.TripPin.PersonGender'Female'</a> <br>Referencing an enumeration value, using logical operator <code>has</code></p>
<p><strong>Categories with fewer than 10 products</strong> <br><a href="http://localhost:4004/northwind-model/Categories?$filter=Products/$count%20lt%2010">Categories?$filter=Products/$count lt 10</a> <br>Using the raw value of the number of items in a collection (via navigation)</p>
<h3 id="arithmetic-operators">Arithmetic operators</h3>
<p><strong>Products with high availability (more than 100 units of stock and backorders combined)</strong> <br><a href="https://services.odata.org/v4/northwind/northwind.svc/Products?$filter=UnitsInStock%20add%20UnitsOnOrder%20gt%20100">Products?$filter=UnitsInStock add UnitsOnOrder gt 100</a> <br>Combining two numeric properties with <code>add</code></p>
<p><strong>Products with a high stock value (over 3,500.00)</strong> <br><a href="https://services.odata.org/v4/northwind/northwind.svc/Products?$filter=UnitsInStock%20mul%20UnitPrice%20gt%203500.00">Products?$filter=UnitsInStock mul UnitPrice gt 3500.00</a> <br>Combining two numeric properties with <code>mul</code></p>
<h3 id="string-functions">String functions</h3>
<p><strong>Suppliers with a '555' phone code, and a homepage</strong> <br><a href="http://localhost:4004/northwind-model/Suppliers?$filter=contains(Phone,%27555%27)%20and%20HomePage%20ne%20%27NULL%27">Suppliers?$filter=contains(Phone,'555') and HomePage ne 'NULL'</a> <br>Using the <code>contains</code> function (note arg order and no spaces)</p>
<p><strong>Products with short names</strong> <br><a href="http://localhost:4004/northwind-model/Products?$filter=length(ProductName)%20lt%205">Products?$filter=length(ProductName) lt 5</a> <br>Combining the canonical function <code>length</code>'s output with the logical operator <code>lt</code></p>
<p><strong>Airports where the IATA and ICAO codes diverge</strong> <br><a href="https://services.odata.org/V4/TripPinService/Airports?$select=Name,IcaoCode,IataCode&amp;$filter=not%20contains(IcaoCode,IataCode)">Airports?$select=Name,IcaoCode,IataCode&amp;$filter=not contains(IcaoCode,IataCode)</a> <br>Using the <code>contains</code> function with the logical operator <code>not</code>, with both parameters passed to <code>contains</code> being properties (see also <a href="https://en.wikipedia.org/wiki/ICAO_airport_code#ICAO_codes_versus_IATA_codes">IATA vs ICAO</a>)</p>
<h3 id="date-time-functions">Date &amp; time functions</h3>
<p><strong>Orders shipped on the first of the month</strong> <br><a href="https://services.odata.org/v4/northwind/northwind.svc/Summary_of_Sales_by_Years?$count=true&amp;$filter=day(ShippedDate)%20eq%201">Summary_of_Sales_by_Years?$count=true&amp;$filter=day(ShippedDate) eq 1</a> <br>Using <code>day</code>, one of many date and time functions, plus <code>$count</code> as a system query option, to show the number of orders</p>
<h3 id="arithmetic-functions">Arithmetic functions</h3>
<p><strong>Products with pennies in the unit price</strong> <br><a href="http://localhost:4004/northwind-model/Products?$filter=round(UnitPrice)%20ne%20UnitPrice">Products?$filter=round(UnitPrice) ne UnitPrice</a> <br>Rounding the <code>UnitPrice</code> value with <code>round</code> and comparing it to what it was with the logical operator <code>ne</code></p>
<h2 id="more-advanced-usage">More advanced usage</h2>
<p><strong>Suppliers and their stocked products, ordered by price</strong> <br><a href="http://localhost:4004/main/Suppliers?$select=CompanyName&amp;$expand=Products($orderby=UnitPrice;$filter=UnitsInStock%20gt%200;$select=ProductName,UnitPrice,UnitsInStock)">Suppliers?$select=CompanyName&amp;$expand=Products($orderby=UnitPrice;$filter=UnitsInStock gt 0;$select=ProductName,UnitPrice,UnitsInStock)</a></p>
<p><strong>Just for info - discontinued products and their categories, by category</strong> <br><a href="http://localhost:4004/northwind-model/Products?$filter=Discontinued%20eq%20true&amp;$select=ProductName&amp;$expand=Category($select=CategoryName,CategoryID)&amp;$orderby=Category/CategoryID">Products?$filter=Discontinued eq true&amp;$select=ProductName&amp;$expand=Category($select=CategoryName,CategoryID)&amp;$orderby=Category/CategoryID</a></p>
<h3 id="using-a-lambda-operator">Using a lambda operator</h3>
<p><strong>Categories that have high stock products</strong> <br><a href="http://localhost:4004/northwind-model/Categories?$expand=Products&amp;$filter=Products/any(x:x/UnitsInStock%20gt%20100)">Categories?$expand=Products&amp;$filter=Products/any(x:x/UnitsInStock gt 100)</a> <br>You can filter on the expanded collection (but this example is probably not what you want)</p>
<p><strong>Categories with no discontinued products</strong> <br><a href="http://localhost:4004/northwind-model/Categories?$expand=Products&amp;$filter=Products/all(x:x/Discontinued%20eq%20false)">Categories?$expand=Products&amp;$filter=Products/all(x:x/Discontinued eq false)</a> <br>Using the <code>all</code> lambda operator (as opposed to <code>any</code>)</p>
<p><strong>Categories with at least some stock for every product</strong> <br><a href="http://localhost:4004/northwind-model/Categories?$expand=Products($select=ProductName)&amp;$filter=Products/all(x:x/UnitsInStock%20gt%200)">Categories?$expand=Products($select=ProductName)&amp;$filter=Products/all(x:x/UnitsInStock gt 0)</a> <br>Another example using <code>all</code>, and restricting the expanded collection data to just the product name</p>
<h3 id="applying-filter-to-an-expanded-navigation-property">Applying filter to an expanded navigation property</h3>
<p><strong>Categories and their discontinued products</strong> <br><a href="http://localhost:4004/northwind-model/Categories?$expand=Products($filter=Discontinued%20eq%20true)">Categories?$expand=Products($filter=Discontinued eq true)</a> <br>A <code>$filter</code> query option can be applied to the expanded navigation property</p>
<p><strong>Categories and the names of their discontinued products</strong> <br><a href="http://localhost:4004/northwind-model/Categories?$expand=Products($filter=Discontinued%20eq%20true;$select=ProductName)">Categories?$expand=Products($filter=Discontinued eq true;$select=ProductName)</a> <br>Multiple system query options can be applied, separated by semicolons</p>
<p><strong>A better list of categories and their discontinued products</strong> <br><a href="http://localhost:4004/northwind-model/Categories?$expand=Products($filter=Discontinued%20eq%20true)&amp;$filter=Products/any(x:x/Discontinued%20eq%20true)">Categories?$expand=Products($filter=Discontinued eq true)&amp;$filter=Products/any(x:x/Discontinued eq true)</a> <br>Combining a <code>$filter</code> on the expanded navigation property with a <code>$filter</code> using the <code>any</code> lambda operator</p>
<h3 id="miscellaneous">Miscellaneous</h3>
<p><strong>Email addresses in the 'example' domain for a person</strong> <br><a href="https://services.odata.org/V4/(S(lx1imovv1xsufthdbddd4sps))/TripPinServiceRW/People(&#39;russellwhyte&#39;)/Emails?$filter=contains($it,%27example%27)">TripPinServiceRW/People('russellwhyte')/Emails?$filter=contains($it,'example')</a> <br>Using the <code>$it</code> literal to refer back to the collection in the resource path (here <code>Emails</code> is just an array of string values)</p>
<h2 id="data-aggregation">Data aggregation</h2>
<p><strong>Most expensive product</strong> <br><a href="http://localhost:4004/main/Products?$apply=aggregate(UnitPrice%20with%20max%20as%20MostExpensive)">Products?$apply=aggregate(UnitPrice with max as MostExpensive)</a></p>
<p><strong>Stock of discontinued products, by category</strong> <br><a href="http://localhost:4004/main/Products?$apply=filter(Discontinued%20eq%20true)/groupby((Category_CategoryID),aggregate(UnitsInStock%20with%20sum%20as%20TotalStock))">Products?$apply=filter(Discontinued eq true)/groupby(Category_CategoryID),aggregate(UnitsInStock with sum as TotalStock))</a></p>
<p><strong>Total order value for 1996</strong> <br><a href="http://localhost:4004/northwind-model/Summary_of_Sales_by_Years?$apply=filter(year(ShippedDate)%20eq%201996)/aggregate(Subtotal%20with%20sum%20as%20Total)">Summary_of_Sales_by_Years?$apply=filter(year(ShippedDate) eq 1996)/aggregate(Subtotal with sum as Total)</a> <br>Using <code>year</code> with a bonus digression on aggregation via <code>$apply</code></p>
